Index: site-manage-tool/tool/src/java/org/sakaiproject/site/tool/SiteAction.java
===================================================================
--- site-manage-tool/tool/src/java/org/sakaiproject/site/tool/SiteAction.java	(revision 104834)
+++ site-manage-tool/tool/src/java/org/sakaiproject/site/tool/SiteAction.java	(working copy)
@@ -2298,7 +2298,7 @@
 				}
 				context.put("published", state.getAttribute(STATE_SITE_ACCESS_PUBLISH));
 				context.put("include", state.getAttribute(STATE_SITE_ACCESS_INCLUDE));
-
+				context.put("shoppingPeriodInstructorEditable", ServerConfigurationService.getBoolean("delegatedaccess.shopping.instructorEditable", false));
 				if (siteType != null && !unJoinableSiteTypes.contains(siteType)) {
 					// site can be set as joinable
 					context.put("disableJoinable", Boolean.FALSE);
Index: site-manage-tool/tool/src/bundle/sitesetupgeneric.properties
===================================================================
--- site-manage-tool/tool/src/bundle/sitesetupgeneric.properties	(revision 104834)
+++ site-manage-tool/tool/src/bundle/sitesetupgeneric.properties	(working copy)
@@ -1057,3 +1057,20 @@
 sitegen.siteinfolist.usermodify = Modified by
 
 useOfficialDescription=Use Official Description
+
+## Site Shopping Period
+shopping.header = Shopping Period Access
+shopping.start.label = Start Date
+shopping.end.label = End Date
+shopping.visibility.label = Visibility
+shopping.role.label = Role
+shopping.role.instructions = Shoppers have the same access as this realm/role.
+shopping.instructions=You have the ability to add, update, or remove your site's shopping access.\
+<ul><li>To add or update, check the box to override inherited settings and just fill in the fields below.</li>\
+<li>To remove, you can click the opt out link and save or check the override inherited settings checkbox and clear all fields and set all options to none.</li>\
+<li>To reset to inherited settings, just uncheck the override inherited settings checkbox and save.</li>\
+</ul>Please allow up to 24 hours for these settings to take into affect.
+shopping.noauth=none
+shopping.showTools.label=Show Tools
+shopping.override.label=Override inherited settings
+shopping.optout.label=Opt My Site Out of Shopping Period
Index: site-manage-tool/tool/src/webapp/vm/sitesetup/chef_site-siteInfo-editAccess.vm
===================================================================
--- site-manage-tool/tool/src/webapp/vm/sitesetup/chef_site-siteInfo-editAccess.vm	(revision 104834)
+++ site-manage-tool/tool/src/webapp/vm/sitesetup/chef_site-siteInfo-editAccess.vm	(working copy)
@@ -4,6 +4,9 @@
 <script type="text/javascript" src="/library/js/jquery/jquery-ui/js/jquery-ui.js"></script>
 <link type="text/css" href="/library/js/jquery/jquery-ui/css/smoothness/jquery-ui.css" rel="stylesheet" media="screen" />
 <script type="text/javascript" src="/sakai-site-manage-tool/js/site-manage.js"></script>
+#if ($shoppingPeriodInstructorEditable)
+	<script type="text/javascript" src="/sakai-site-manage-tool/js/site-manage-shopping.js"></script>
+#end
 <script type="text/javascript">
 <!-- hide from non-JS browsers
 	function checkPublish(checked)
@@ -42,6 +45,8 @@
 			utils.resizeFrame('shrink');
 		}
 	}
+	
+	
 // -->	
 </script>
 <link type="text/css" href="/sakai-site-manage-tool/css/site-manage.css" rel="stylesheet" media="screen" />
@@ -212,12 +217,85 @@
 			</p>
 			<p/>
 		</div>
+
+		<span id="siteId" style="display:none">$site.id</span>
+		#if ($shoppingPeriodInstructorEditable)
+		<div id="shoppingVisibilityDiv" style="display:none">
+			<!-- easy access for JS -->
+			
+			<h4>$tlang.getString("shopping.header")</h4>
+			<div class="instruction">
+				$tlang.getString("shopping.instructions")
+			</div>
+			<div class="indnt1">
+				<a href="#" onclick="optOutOfShoppingPeriod(); return false;">
+					$tlang.getString("shopping.optout.label")
+				</a>
+				<br/>
+				<br/>
+				<input type="checkbox" name="shoppingPeriodOverride" id="shoppingPeriodOverride" onclick="setShoppingSettingsDisabled(!this.checked);"/>
+				<label for"shoppingPeriodOverride">$tlang.getString("shopping.override.label"): </label>
+				
+				<table>
+				<tr>
+				<td align="right">
+			 	<label for="shoppingVisibility">$tlang.getString("shopping.visibility.label"): </label>
+				</td>
+				<td>
+				<select name="shoppingVisibility" id="shoppingVisibility" class="shoppingSetting">
+					<option value="">$tlang.getString("shopping.noauth")</option>
+				</select>
+				</td>
+				</tr>
+				<tr>
+                                <td align="right">
+				<label for="shoppingVisibilityStart">$tlang.getString("shopping.start.label"): </label>
+				</td>
+				<td>
+				<input type="text" id="shoppingVisibilityStart" name="shoppingVisibilityStart" class="shoppingSetting" value=""/>
+				</td>
+				</tr>
+                                <tr>
+                                <td align="right">
+				<label for="shoppingVisibilityEnd">$tlang.getString("shopping.end.label"): </label>
+				</td>
+                                <td>
+				<input type="text" id="shoppingVisibilityEnd" name="shoppingVisibilityEnd" class="shoppingSetting" value=""/>
+				</td>
+				</tr>
+				<tr>
+				<td align="right">
+				<label for="shoppingRole">$tlang.getString("shopping.role.label"): </label>
+				</td>
+				<td>
+				<select name="shoppingRole" id="shoppingRole" class="shoppingSetting">
+					<option value="">$tlang.getString("shopping.noauth")</option>
+				</select>
+				</td>
+				</tr>
+				<tr>
+					<td>
+						<label for="showTools">$tlang.getString("shopping.showTools.label"): </label>
+					</td>
+					<td>
+						<select name="showTools" id="showTools" multiple="multiple" class="shoppingSetting" style="height: 100px">
+							<option value=""></option>
+						</select>
+					</td>
+				</tr>
+				</table>
+			</div>
+			</div>
+
+		</div>
+		#end
 		<input type="hidden" name="continue" value="$!continue" />
 		<input type="hidden" name="back" value="$!backIndex" />
 		<input type="hidden" name="templateIndex" value="$!templateIndex" />
 		<div class ="act">
 			#if($!site)
-				<input type="submit" accesskey="s" class="active" name="eventSubmit_doUpdate_site_access" value="$tlang.getString("ediacc.upd")" />
+				<input type="submit" accesskey="s" id="updateButton" 
+					class="active" name="eventSubmit_doUpdate_site_access" value="$tlang.getString("ediacc.upd")" />
 				<input type="submit" accesskey="x"  name="eventSubmit_doCancel" value="$tlang.getString("ediacc.bac")" />
 #else
 				<input type="submit" accesskey="s" class="active" name="eventSubmit_doUpdate_site_access" value="$tlang.getString("ediacc.con")" />
Index: site-manage-tool/tool/src/webapp/js/site-manage-shopping.js
===================================================================
--- site-manage-tool/tool/src/webapp/js/site-manage-shopping.js	(revision 0)
+++ site-manage-tool/tool/src/webapp/js/site-manage-shopping.js	(revision 0)
@@ -0,0 +1,152 @@
+// Shopping Period JS
+$(document).ready(function(){
+
+	// Decorate the date inputs
+	$("#shoppingVisibilityStart").datepicker();
+	$("#shoppingVisibilityEnd").datepicker();
+	
+	// Get the shopping info for this site from a WS
+	$.getJSON("/direct/delegated_access/" + $('#siteId').html() + ".json",
+		function(response){
+			var data = response.data;
+		
+			//add auth options
+			$.getJSON("/direct/delegated_access/shoppingOptions/authorization.json", 
+				function(response){
+					for (var i=0; i<response.delegated_access_collection.length; i++) {
+						if(response.delegated_access_collection[i].key === data.shoppingAuth){
+							$('#shoppingVisibility')
+								.append($("<option selected></option>")
+								.attr("value",response.delegated_access_collection[i].key)
+								.text(response.delegated_access_collection[i].value));
+						}else{
+							$('#shoppingVisibility')
+								.append($("<option></option>")
+								.attr("value",response.delegated_access_collection[i].key)
+								.text(response.delegated_access_collection[i].value));
+						}
+					}
+				}
+			);
+			
+			//add role options
+			$.getJSON("/direct/delegated_access/shoppingOptions/roles.json", 
+				function(response){
+					for (var i=0; i<response.delegated_access_collection.length; i++) {
+						if(response.delegated_access_collection[i].key === data.shoppingRealm + ":" + data.shoppingRole){
+							$('#shoppingRole')
+								.append($("<option selected></option>")
+								.attr("value",response.delegated_access_collection[i].key)
+								.text(response.delegated_access_collection[i].value));
+						}else{
+							$('#shoppingRole')
+								.append($("<option></option>")
+								.attr("value",response.delegated_access_collection[i].key)
+								.text(response.delegated_access_collection[i].value));
+						}
+					}
+				}
+			);
+			//add showTools options
+			$.getJSON("/direct/delegated_access/shoppingOptions/tools.json", 
+				function(response){
+					for (var i=0; i<response.delegated_access_collection.length; i++) {
+						if($.inArray(response.delegated_access_collection[i].key, data.shoppingShowTools) >= 0){
+							$('#showTools')
+								.append($("<option selected></option>")
+								.attr("value",response.delegated_access_collection[i].key)
+								.text(response.delegated_access_collection[i].value));
+						}else{
+							$('#showTools')
+								.append($("<option></option>")
+								.attr("value",response.delegated_access_collection[i].key)
+								.text(response.delegated_access_collection[i].value));
+						}
+					}
+				}
+			);
+		
+            
+            $('#shoppingVisibilityDiv').show();
+            $('#shoppingVisibility').val(data.shoppingAuth);
+            
+            if (data.shoppingStartDate != undefined && data.shoppingStartDate != ""){
+                var shoppingStartDate = new Date(parseInt(data.shoppingStartDate));
+                $('#shoppingVisibilityStart').val($.datepicker.formatDate("mm/dd/yy", shoppingStartDate));
+            }
+            if (data.shoppingEndDate != undefined && data.shoppingEndDate != ""){
+                var shoppingEndDate = new Date(parseInt(data.shoppingEndDate));
+                $('#shoppingVisibilityEnd').val($.datepicker.formatDate("mm/dd/yy", shoppingEndDate));
+            }
+            
+            //disable options if this shopping site isn't directAccess (option for overriding inheritted settings)
+            if(!data.directAccess){
+            	setShoppingSettingsDisabled(true);
+            }else{
+            	$('#shoppingPeriodOverride').attr("checked", true);
+            }
+	    }
+	);
+	
+	
+	
+	// Gather the shopping variables and save them to a WS
+	$("#updateButton").click(function(){
+        try {
+	     
+            var start = "";
+		    try{
+			start  = $.datepicker.parseDate("mm/dd/yy", $('#shoppingVisibilityStart').val()).getTime();
+		    }catch(err){}
+		    var end = "";
+		    try{
+			end   = $.datepicker.parseDate("mm/dd/yy", $('#shoppingVisibilityEnd').val()).getTime();
+		    }catch(err){}
+		    var shoppingRole = "";
+		    var shoppingRealm = "";
+		    try{
+		    	var split = $("#shoppingRole").val().split(":");
+		    	shoppingRealm = split[0];
+		    	shoppingRole = split[1];
+		    }catch(err){
+		    	shoppingRealm = "";
+		    	shoppingRole = "";
+		    }
+            var data = {
+                'shoppingAuth'      : $('#shoppingVisibility option:selected').val(),
+                'shoppingStartDate' : start,
+                'shoppingEndDate'   : end,
+                'shoppingRealm'     : shoppingRealm,
+                'shoppingRole'      : shoppingRole,
+                'shoppingShowTools' : $('#showTools').val(),
+                'directAccess': document.getElementById('shoppingPeriodOverride').checked
+            };
+            var form = $('form[name=editParticipantForm]');
+
+            $.ajax({
+                type: 'POST',
+                url: "/direct/delegated_access/" + $('#siteId').html() + ".json",
+                data: data,
+                async:false,
+                failure: function failure(data){
+                    // TODO: internationalize
+                    alert("There was an error saving the shopping period info.");
+                    },
+                });
+        }
+        catch (error){
+            console.log(error);
+        }
+	});
+});
+
+function setShoppingSettingsDisabled(disabled){
+	$(".shoppingSetting").attr("disabled", disabled);
+}
+
+function optOutOfShoppingPeriod(){
+	$('#shoppingPeriodOverride').attr('checked', true);
+	$('.shoppingSetting').attr('value', '');
+	setShoppingSettingsDisabled(false)
+}
+

Property changes on: site-manage-tool/tool/src/webapp/js/site-manage-shopping.js
___________________________________________________________________
Added: svn:keywords
   + Date Revision Author HeadURL Id
Added: svn:eol-style
   + native

